<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>ğŸ” êµë¥˜íšŒìš©</title>
  <link rel="stylesheet" href="./style.css">
  <style>
    :root {
      --bg-1: #1a0b12;
      --bg-2: #2a1020;
      --bg-3: #4d0f2a;
    }
  </style>
</head>
<body>
  <main class="flow" aria-live="polite" aria-relevant="additions" aria-label="ë‹¨ê³„ë³„ ì–‘ì‹">
      <h1 class="form-title">ã€ŠğŸ” êµë¥˜íšŒ ì–‘ì‹ã€‹</h1>
      <p style="color:#fff5a7;padding:.5rem;font-weight:700;">ê¹¡ê³„ ë˜ëŠ” êµë¥˜íšŒ ì£¼ìµœ ê²½í—˜ 5íšŒ ì´í•˜ì¸ ìëŠ” ğŸ” êµë¥˜íšŒ ì£¼ìµœ ë¶ˆê°€</p>
      <!-- 1. êµë¥˜íšŒ ì¼ì • (ë‚ ì§œ, ì‹œê°„, í”½ì—… ì—¬ë¶€) -->
      <section class="step" data-require="selects">
        <div class="label">1. êµë¥˜íšŒ ì¼ì •</div>
        <div class="rules">
          <div class="rule-row">
            <div class="sub-label">ë‚ ì§œ</div>
            <div class="rule-field date">
              <div class="field-group">
                <label class="sr-only" for="m">ì›”</label>
                <select id="m" class="sel month" required>
                  <option value="">ì›”</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                </select><span class="suffix">ì›”</span>
              </div>
              <div class="field-group">
                <label class="sr-only" for="d">ì¼</label>
                <select id="d" class="sel day" required>
                  <option value="">ì¼</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                  <option value="24">24</option>
                  <option value="25">25</option>
                  <option value="26">26</option>
                  <option value="27">27</option>
                  <option value="28">28</option>
                  <option value="29">29</option>
                  <option value="30">30</option>
                  <option value="31">31</option>
                </select><span class="suffix">ì¼</span>
              </div>
            </div>
          </div>
          <div class="rule-row">
            <div class="sub-label">ì‹œê°„</div>
            <div class="rule-field time">
              <div class="field-group">
                <label class="sr-only" for="sh">ì‹œì‘ ì‹œê°„ ì‹œ</label>
                <select id="sh" class="sel hour" required>
                  <option value="">ì‹œ</option>
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                </select><span class="suffix">ì‹œ</span>
              </div>
              <div class="field-group">
                <label class="sr-only" for="sm">ì‹œì‘ ì‹œê°„ ë¶„</label>
                <select id="sm" class="sel minute" required>
                  <option value="">ë¶„</option>
                  <option value="5">5</option>
                  <option value="10">10</option>
                  <option value="15">15</option>
                  <option value="20">20</option>
                  <option value="25">25</option>
                  <option value="30">30</option>
                  <option value="35">35</option>
                  <option value="40">40</option>
                  <option value="45">45</option>
                  <option value="50">50</option>
                  <option value="55">55</option>
                </select><span class="suffix">ë¶„</span>
              </div>
              <span class="sep">~</span>
              <div class="field-group">
                <label class="sr-only" for="eh">ì¢…ë£Œ ì‹œê°„ ì‹œ</label>
                <select id="eh" class="sel hour" required>
                  <option value="">ì‹œ</option>
                  <option value="0">0</option>
                  <option value="1">1</option>
                  <option value="2">2</option>
                  <option value="3">3</option>
                  <option value="4">4</option>
                  <option value="5">5</option>
                  <option value="6">6</option>
                  <option value="7">7</option>
                  <option value="8">8</option>
                  <option value="9">9</option>
                  <option value="10">10</option>
                  <option value="11">11</option>
                  <option value="12">12</option>
                  <option value="13">13</option>
                  <option value="14">14</option>
                  <option value="15">15</option>
                  <option value="16">16</option>
                  <option value="17">17</option>
                  <option value="18">18</option>
                  <option value="19">19</option>
                  <option value="20">20</option>
                  <option value="21">21</option>
                  <option value="22">22</option>
                  <option value="23">23</option>
                </select><span class="suffix">ì‹œ</span>
              </div>
              <div class="field-group">
                <label class="sr-only" for="em">ì¢…ë£Œ ì‹œê°„ ë¶„</label>
                <select id="em" class="sel minute" required>
                  <option value="">ë¶„</option>
                  <option value="5">5</option>
                  <option value="10">10</option>
                  <option value="15">15</option>
                  <option value="20">20</option>
                  <option value="25">25</option>
                  <option value="30">30</option>
                  <option value="35">35</option>
                  <option value="40">40</option>
                  <option value="45">45</option>
                  <option value="50">50</option>
                  <option value="55">55</option>
                </select><span class="suffix">ë¶„</span>
              </div>
            </div>
          </div>
          <div class="rule-row">
            <div class="sub-label">í”½ì—… ì—¬ë¶€</div>
            <div class="rule-field">
              <label class="sr-only" for="pickup">í”½ì—… ì—¬ë¶€</label>
              <input id="pickup" class="txt title-half" type="text" placeholder="ì˜ˆì‹œ: ì—†ìŒ, 20ë¶„ë§ˆë‹¤, 23ì‹œì— í•œ ë²ˆ ë“±" required>
            </div>
          </div>
        </div>
      </section>

      <!-- 2. êµë¥˜íšŒ ì œëª© ë° ë‚´ìš© (í…ìŠ¤íŠ¸) -->
      <section class="step collapsed" data-require="texts">
        <div class="label">2. êµë¥˜íšŒ ì œëª© ë° ë‚´ìš©</div>
        <div class="rules">
          <div class="rule-row">
            <div class="sub-label">ì œëª©</div>
            <div class="rule-field">
              <input id="title" class="txt title-big" type="text" placeholder="ì˜ˆì‹œ: ì•ŒìŒêµ, ì–´ë‘ ì˜ ëª¸ë§ êµë¥˜íšŒ ë“±" required>
            </div>
          </div>
          <div class="rule-row">
            <div class="sub-label">ë‚´ìš©</div>
            <div class="rule-field">
              <input id="desc" class="txt title-big" type="text" placeholder="ì˜ˆì‹œ: ì°Œì°Œ ë³´ë©´ì„œ ìˆ  ë¨¹ê¸°, ì•Œëª¸ìœ¼ë¡œ ëª¸ë§í•˜ê¸° ë“±" required>
            </div>
          </div>
        </div>
      </section>

      <!-- 3. ê¸°ë³¸ ê·œì¹™ -->
      <section class="step collapsed" data-require="rules">
        <div class="label">3. ê¸°ë³¸ ê·œì¹™</div>
          <div class="rules">
            <div class="rule-row">
              <div class="sub-label">ì§‘í•© ì¥ì†Œ</div>
              <div class="rule-field">
                <div class="choicebar" role="group" data-target="worldName" data-target2="worldUrl" aria-label="ì§‘í•© ì¥ì†Œ ì„ íƒ">
                  <button type="button" class="chip" data-value="New Arcalive" data-url="https://vrchat.com/home/world/wrld_c83f258f-e8f3-44a9-b8da-ed7a09e001c3">New Arcalive</button>
                  <button type="button" class="chip" data-value="Arcalive ë¶€ë„ëŸ¬" data-url="https://vrchat.com/home/world/wrld_f760f71c-281d-4d26-93b3-0dbb983843ee" data-tooltip="ì¶œë°œ ì‹œê°„ì´ ê²¹ì¹˜ì§€ ì•ŠëŠ” ì´ìƒ New ArcaLiveë¥¼ ìµœìš°ì„ ìœ¼ë¡œ í•  ê²ƒ">Arcalive ë¶€ë„ëŸ¬</button>
                  <button type="button" class="chip custom" data-tooltip="ì¶œë°œ ì‹œê°„ì´ ê²¹ì¹˜ì§€ ì•ŠëŠ” ì´ìƒ New Arcaliveë¥¼ ìµœìš°ì„ ìœ¼ë¡œ í•  ê²ƒ">ê¸°íƒ€</button>
                </div>
                <input type="text" class="txt title-half chip-input" placeholder="ì›”ë“œ ì´ë¦„" hidden>
                <input type="text" class="txt title-half chip-input" placeholder="ì›”ë“œ URL" hidden>
                <input type="hidden" id="worldName" required>
                <input type="hidden" id="worldUrl" required>
              </div>
            </div>
            <div class="rule-row">
              <div class="sub-label">êµë¥˜íšŒ ì •ì›</div>
              <div class="rule-field inline">
                <input id="quota" class="txt quota-small" type="text" placeholder="ì˜ˆì‹œ: 20" required><span class="suffix">ëª…</span>
              </div>
            </div>
            <div class="rule-row">
              <div class="sub-label">í…ìŠ¤ì³ ë©”ëª¨ë¦¬ ì œí•œ</div>
              <div class="rule-field inline">
                <input id="texmem" class="txt quota-small" type="text" placeholder="ì˜ˆì‹œ: 200" required><span class="suffix">MB</span>
              </div>
            </div>
          <div class="rule-row">
            <div class="sub-label">ê¸°ê¸° ì°©ìš© ì—¬ë¶€</div>
            <div class="rule-field">
              <div class="choicebar" role="group" data-target="rule1" aria-label="ê¸°ê¸° ì°©ìš© ì—¬ë¶€ ì„ íƒ">
                <button type="button" class="chip" data-value="device-free">ììœ </button>
                <button type="button" class="chip" data-value="device-cam-req">ìº íŠ¸ ì´ìƒ í•„ìˆ˜</button>
                <button type="button" class="chip" data-value="device-half-req">ë°˜íŠ¸ ì´ìƒ í•„ìˆ˜</button>
                <button type="button" class="chip" data-value="device-full-req">í’€íŠ¸ í•„ìˆ˜</button>
                <button type="button" class="chip custom" data-input="rule1-custom">ê¸°íƒ€</button>
              </div>
              <input type="text" id="rule1-custom" class="txt title-half chip-input" placeholder="ì˜ˆì‹œ: ì°¨ë ·ë„ ë˜ì§€ë§Œ ê²Œì„ ì¡°ì‘ì´ ì–´ë ¤ì›€ ë“±" hidden>
              <input type="hidden" id="rule1" required>
            </div>
          </div>
          <div class="rule-row">
            <div class="sub-label">ë¬µì–¸ í—ˆìš© ì—¬ë¶€</div>
            <div class="rule-field">
              <div class="choicebar" role="group" data-target="rule2" aria-label="ë¬µì–¸ í—ˆìš© ì—¬ë¶€ ì„ íƒ">
                <button type="button" class="chip" data-value="silence-allow">í—ˆìš©</button>
                <button type="button" class="chip" data-value="silence-cam-allow">ìº íŠ¸ ì´ìƒ í—ˆìš©</button>
                <button type="button" class="chip" data-value="silence-half-allow">ë°˜íŠ¸ ì´ìƒ í—ˆìš©</button>
                <button type="button" class="chip" data-value="silence-full-allow">í’€íŠ¸ë§Œ í—ˆìš©</button>
                <button type="button" class="chip" data-value="silence-ban">ê¸ˆì§€</button>
                <button type="button" class="chip custom" data-input="rule2-custom">ê¸°íƒ€</button>
              </div>
              <input type="text" id="rule2-custom" class="txt title-half chip-input" placeholder="ì˜ˆì‹œ: ë§ˆì´í¬ ê¶Œì¥ì´ê³  í•„ìˆ˜ëŠ” ì•„ë‹˜ ë“±" hidden>
              <input type="hidden" id="rule2" required>
            </div>
          </div>
          <div class="rule-row">
            <div class="sub-label">PCSS í—ˆìš© ì—¬ë¶€</div>
            <div class="rule-field">
              <div class="choicebar" role="group" data-target="rule3" aria-label="PCSS í—ˆìš© ì—¬ë¶€ ì„ íƒ">
                <button type="button" class="chip" data-value="pcss-allow">í—ˆìš©</button>
                <button type="button" class="chip" data-value="pcss-ban">ê¸ˆì§€</button>
                <button type="button" class="chip custom" data-input="rule3-custom">ê¸°íƒ€</button>
              </div>
              <input type="text" id="rule3-custom" class="txt title-half chip-input" placeholder="ì˜ˆì‹œ: ì‚¬ì§„ êµë¥˜íšŒì—ì„œ ì´¬ì˜ ì¤‘ì—ë§Œ ë¶€ë¶„ì  í—ˆìš© ë“±" hidden>
              <input type="hidden" id="rule3" required>
            </div>
          </div>
        </div>
      </section>

      <!-- 4. ë³µì¥ ê·œì¹™ (ì¹© ë²„íŠ¼) -->
      <section class="step collapsed" data-require="choice">
        <div class="label">4. ë³µì¥ ê·œì¹™</div>
        <div class="choicebar" role="group" data-target="mode" data-desc-target="mode-desc" aria-label="ë³µì¥ ê·œì¹™ ì„ íƒ">
          <button type="button" class="chip" data-value="attire-conservative" data-desc="ì¼ë°˜ì ìœ¼ë¡œ ê³µê³µì¥ì†Œì—ì„œ ì…ì–´ë„ ë¬¸ì œ ì—†ëŠ” ë³µì¥">ê±´ì „í•œ ë³µì¥</button>
          <button type="button" class="chip" data-value="attire-moderate" data-desc="ì†ì˜·, ìˆ˜ì˜ë³µ, ë¹„í‚¤ë‹ˆ(ë§ˆì´í¬ë¡œ ì œì™¸) ë“± 15ê¸ˆ ìˆ˜ìœ„ì˜ ë³µì¥">ì ë‹¹í•œ ë…¸ì¶œ</button>
          <button type="button" class="chip" data-value="attire-free" data-desc="ë³µì¥ ì œí•œ ì—†ìŒ">ììœ  ë³µì¥</button>
          <button type="button" class="chip" data-value="attire-nude" data-desc="ì•Œëª¸, ë˜ëŠ” ê·¸ì— ì¤€í•˜ëŠ” ë³µì¥ë§Œ í—ˆìš©">ì•Œëª¸ë§Œ í—ˆìš©</button>
          <button type="button" class="chip custom" data-input="mode-custom">ê¸°íƒ€</button>
        </div>
        <p class="chip-desc" id="mode-desc" hidden></p>
        <input type="text" id="mode-custom" class="txt title-half chip-input" placeholder="ì˜ˆì‹œ: ì—­ë°”ë‹ˆ êµë¥˜íšŒë‹ˆê¹Œ ì—­ë°”ë‹ˆë§Œ í—ˆìš© ë“±" hidden>
        <input type="hidden" id="mode" required>
      </section>

      <!-- 5. ìƒí˜¸ì‘ìš© ê·œì¹™ (ì¹© ë²„íŠ¼) -->
      <section class="step collapsed" data-require="choice">
        <div class="label">5. ìƒí˜¸ì‘ìš© ê·œì¹™</div>
        <div class="choicebar" role="group" data-target="interaction" data-desc-target="interaction-desc" aria-label="ìƒí˜¸ì‘ìš© ê·œì¹™ ì„ íƒ">
          <button type="button" class="chip" data-value="interaction-free" data-desc="ì“°ë‹´, ë³¼ í„°ì¹˜ ë“± ê³µê³µì¥ì†Œì—ì„œ í•´ë„ ë¬¸ì œ ì—†ëŠ” í–‰ìœ„ë§Œ í—ˆìš©">ê±´ì „í•˜ê²Œ</button>
          <button type="button" class="chip" data-value="interaction-need" data-desc="í‚¤ìŠ¤, ê°€ìŠ´ í„°ì¹˜ ë“± ê·œì¹™ ìƒ ì„±í–‰ìœ„ì— í¬í•¨í•˜ì§€ ì•ŠëŠ” í–‰ìœ„ê¹Œì§€ í—ˆìš©">ì•½í•œ ìˆ˜ìœ„</button>
          <button type="button" class="chip" data-value="interaction-none" data-desc="ìƒí˜¸ì‘ìš© ì œí•œ ì—†ìŒ">ì œí•œ ì—†ìŒ</button>
          <button type="button" class="chip custom" data-input="interaction-custom">ê¸°íƒ€</button>
        </div>
        <p class="chip-desc" id="interaction-desc" hidden></p>
        <input type="text" id="interaction-custom" class="txt title-half chip-input" placeholder="ì˜ˆì‹œ: ê¸°ë³¸ì€ ì•½í•œ ìˆ˜ìœ„ê³  ë²Œì¹™ íƒ€ì„ë§Œ ì œí•œ ì—†ìŒ ë“±" hidden>
        <input type="hidden" id="interaction" required>
      </section>

      <!-- 6. ê·¸ ì™¸ ì•ˆë‚´ì‚¬í•­ (í…ìŠ¤íŠ¸) -->
      <section class="step collapsed" data-require="text">
        <div class="label">6. ê·¸ ì™¸ ì•ˆë‚´ì‚¬í•­</div>
        <textarea id="notice" class="txt title-big triple" placeholder="ìœ„ì— ì—†ëŠ” ë‚´ìš© ì¤‘ ì•ˆë‚´í•´ì•¼ í•  ë‚´ìš©ë“¤ì„ ê¸°ì¬"></textarea>
      </section>

      <!-- 7. ê·œì¹™ ìœ„ë°˜ì‹œ ì¡°ì¹˜ (í…ìŠ¤íŠ¸) -->
      <section class="step collapsed" data-require="text">
        <div class="label">7. ê·œì¹™ ìœ„ë°˜ì‹œ ì¡°ì¹˜</div>
        <textarea id="penalty" class="txt title-big triple" placeholder="ì˜ˆì‹œ: 1ì°¨ ê²½ê³ /2ì°¨ í‚¥, ì£¼ìµœì ì§€ì‹œë¥¼ ë”°ë¥´ì§€ ì•Šìœ¼ë©´ ê°•ì œ í‡´ì¥ ì¡°ì¹˜ ë“±"></textarea>
      </section>

    <!-- ì™„ë£Œ ë²„íŠ¼: ë§ˆì§€ë§‰ ë‹¨ê³„ê¹Œì§€ ì±„ì›Œì§€ë©´ í‘œì‹œ -->
    <div class="nav collapsed">
      <button class="btn done" type="button">ì™„ë£Œ</button>
    </div>

    <div id="result-popup" class="modal" hidden>
      <div class="modal-content">
        <button type="button" class="close-btn" aria-label="ë‹«ê¸°"><span aria-hidden="true">&times;</span></button>
        <p class="guide-text"><img src="001.png" alt="ì¶œë ¥ í™œìš© ì•ˆë‚´"><br><br>
          â–· ì•„ë˜ì— ìƒì„±ëœ ë‚´ìš©ì„ ëª¨ì§‘ê¸€ ì œëª©/ë‚´ìš©ì— ê°ê° ë³µì‚¬í•˜ê¸°<br>
          â–· ë‚´ìš© ë¶€ë¶„ì€ PC ê¸€ì“°ê¸° í™”ë©´ ê¸°ì¤€ ìš°ìƒë‹¨ì— ìˆëŠ” ì½”ë”© ëª¨ë“œ(ë¹¨ê°„ìƒ‰ ì›)ë¡œ ë“¤ì–´ê°„ ë‹¤ìŒ ë¶™ì—¬ë„£ê¸°<br>
          - ì–‘ì‹ ê´€ë¦¬ + í•˜ì´í¼ë§í¬ ê¸°ëŠ¥ì„ ìœ„í•´ì„œ ì•½ê°„ ë²ˆê±°ë¡­ë”ë¼ë„ ì–‘í•´ ë°”ëŒ<br>
          - ëª¨ë°”ì¼ì—ì„œ ì‘ì„± ì‹œ ê³µì•±ì€ ì½”ë”© ëª¨ë“œê°€ ë¶ˆê°€ëŠ¥í•˜ë¯€ë¡œ ë¸Œë¼ìš°ì €ë¡œ ë“¤ì–´ê°€ì„œ ì¨ì•¼ í•¨<br><br><hr><br></p>
        <div class="result-row">
          <label class="result-label" for="result-title">ëª¨ì§‘ê¸€ ì œëª©</label>
          <input id="result-title" class="txt result-field" readonly>
        </div>
        <div class="result-row">
          <label class="result-label" for="result-body">ëª¨ì§‘ê¸€ ë‚´ìš©</label>
          <textarea id="result-body" class="txt result-field" readonly></textarea>
        </div>
      </div>
    </div>
  </main>

  <script>
    const steps = [...document.querySelectorAll('.step')];
    const nav = document.querySelector('.nav');
    const popup = document.getElementById('result-popup');
    const resultTitle = document.getElementById('result-title');
    const resultBody = document.getElementById('result-body');
    const popupContent = popup.querySelector('.modal-content');
    popup.querySelector('.close-btn').addEventListener('click', () => {
      popupContent.classList.remove('show');
      popupContent.classList.add('hide');
      popupContent.addEventListener('animationend', () => {
        popup.hidden = true;
        popupContent.classList.remove('hide');
      }, { once: true });
    });

    let visibleCount = 1; // ì²˜ìŒì—” 1ê°œë§Œ ë³´ì„
    let doneShown = false;

    function setValidity(el, ok){ el.classList.toggle('is-valid', ok); }

      function validateStep(step){
        const type = step.dataset.require; let ok = false;
        if(type === 'selects'){
          const sels = step.querySelectorAll('select'); ok = true;
          sels.forEach(sel=>{ const v = sel.value !== ''; setValidity(sel, v); ok = ok && v; });
          const p = step.querySelector('#pickup');
          if(p){ const pv = !!p.value.trim(); setValidity(p, pv); ok = ok && pv; }
        } else if(type === 'select'){
          const sel = step.querySelector('select'); ok = !!sel && sel.value !== ''; setValidity(sel, ok);
        } else if(type === 'text'){
          const t = step.querySelector('.txt'); ok = !!t.value.trim(); setValidity(t, ok);
        } else if(type === 'texts'){
          const ts = step.querySelectorAll('.txt'); ok = true;
          ts.forEach(t=>{ const v = !!t.value.trim(); setValidity(t, v); ok = ok && v; });
        } else if(type === 'number'){
          const n = step.querySelector('.txt'); const v = Number(n.value); ok = Number.isFinite(v) && v > 0; setValidity(n, ok);
        } else if(type === 'choice'){
          const hs = step.querySelectorAll('input[type="hidden"]'); ok = true;
          hs.forEach(h=>{ const v = !!h.value; ok = ok && v; });
        } else if(type === 'rules'){
        const hs = step.querySelectorAll('input[type="hidden"]'); ok = true;
        hs.forEach(h=>{ const v = !!h.value; ok = ok && v; });
        const q = step.querySelector('#quota');
        const nv = Number(q.value); const qok = Number.isFinite(nv) && nv > 0; setValidity(q, qok); ok = ok && qok;
        const tm = step.querySelector('#texmem');
        const tv = Number(tm.value); const tmok = Number.isFinite(tv) && tv > 0; setValidity(tm, tmok); ok = ok && tmok;
      }
      return ok;
    }

      function animateReveal(el){
        el.classList.remove('collapsed');
        el.style.opacity = '0';
        el.style.transform = 'translateY(6px)';
        el.style.transition = 'none';
        requestAnimationFrame(()=>{
          el.style.transition = 'opacity .7s ease, transform .7s ease';
          el.style.opacity = '1';
          el.style.transform = 'none';
          el.addEventListener('transitionend', ()=>{
            el.style.transition = '';
            el.style.opacity = '';
            el.style.transform = '';
          }, { once:true });
        });
      }

      function revealNext(){
        if(visibleCount >= steps.length) return;
        if(visibleCount === 5){
          animateReveal(steps[5]);
          animateReveal(steps[6]);
          visibleCount += 2;
          return;
        }
        const next = steps[visibleCount];
        animateReveal(next);
        visibleCount++;
      }

    function showDone(){
      if(doneShown) return;
      doneShown = true;
      nav.classList.remove('collapsed');
      nav.style.opacity = '0';
      nav.style.transform = 'translateY(6px)';
      nav.style.transition = 'none';
      requestAnimationFrame(()=>{
        nav.style.transition = 'opacity .7s ease, transform .7s ease';
        nav.style.opacity = '1';
        nav.style.transform = 'none';
        nav.addEventListener('transitionend', ()=>{
          nav.style.transition = '';
          nav.style.opacity = '';
          nav.style.transform = '';
        }, { once:true });
      });
    }

    // ì´ˆê¸° ì ‘ê¸°
    steps.slice(1).forEach(s => s.classList.add('collapsed'));

    // ì…ë ¥ ë³€í™” â†’ ìœ íš¨ì„±/í…Œë‘ë¦¬ ê°±ì‹  + ìë™ ë‹¤ìŒ ë‹¨ê³„ í‘œì‹œ
    ['input','change'].forEach(ev=>{
      document.addEventListener(ev, e=>{
        const s = e.target.closest('.step');
        if(!s) return;
        const ok = validateStep(s);
        const idx = steps.indexOf(s);
        if(idx === visibleCount-1 && ok){
          if(idx === steps.length-1) showDone();
          else revealNext();
        }
      });
    });

    // ì¹© ì„ íƒ ì²˜ë¦¬
    document.addEventListener('click', (e)=>{
      const chip = e.target.closest('.chip');
      if(!chip) return;
      const bar = chip.closest('.choicebar');
      bar.querySelectorAll('.chip').forEach(c=>c.setAttribute('aria-pressed','false'));
      chip.setAttribute('aria-pressed','true');
      const stepEl = chip.closest('.step');
      const hidden = document.getElementById(bar.dataset.target);
      const hidden2 = document.getElementById(bar.dataset.target2);
      const descEl = document.getElementById(bar.dataset.descTarget);
      const field = bar.closest('.rule-field');
      const inputs = (field || stepEl).querySelectorAll('.chip-input');
      if(chip.classList.contains('custom')){
        if(descEl) descEl.hidden = true;
        inputs.forEach((input, idx)=>{
          input.hidden = false;
          if(idx === 0) input.focus();
          const h = idx === 0 ? hidden : hidden2;
          if(h) h.value = input.value.trim();
          input.oninput = () => {
            if(h) h.value = input.value.trim();
            validateStep(stepEl);
          };
        });
      } else {
        if(descEl){
          const d = chip.dataset.desc || '';
          descEl.textContent = d;
          descEl.hidden = d === '';
        }
        inputs.forEach(input=>{ input.hidden = true; input.value = ''; });
        if(hidden) hidden.value = chip.dataset.value;
        if(hidden2) hidden2.value = chip.dataset.url || '';
      }
      const ok = validateStep(stepEl);
      const idx = steps.indexOf(stepEl);
      if(idx === visibleCount-1 && ok){
        if(idx === steps.length-1) showDone();
        else revealNext();
      }
    });

    document.querySelector('.btn.done').addEventListener('click', () => {
      const getChipText = id => {
        const bar = document.querySelector(`[data-target="${id}"]`);
        if(!bar) return '';
        const chip = bar.querySelector('.chip[aria-pressed="true"]');
        if(!chip) return '';
        if(chip.classList.contains('custom')){
          const input = document.getElementById(`${id}-custom`);
          return input ? input.value.trim() : '';
        }
        return chip.textContent.trim();
      };
      const m = document.getElementById('m').value;
      const d = document.getElementById('d').value;
      const sh = document.getElementById('sh').value;
      const sm = document.getElementById('sm').value;
      const eh = document.getElementById('eh').value;
      const em = document.getElementById('em').value;
      const title = document.getElementById('title').value.trim();
      const pickup = document.getElementById('pickup').value.trim();
      const desc = document.getElementById('desc').value.trim();
      const quota = document.getElementById('quota').value.trim();
      const texmem = document.getElementById('texmem').value.trim();
      const worldName = document.getElementById('worldName').value.trim();
      const worldUrl = document.getElementById('worldUrl').value.trim();
      const rule1 = getChipText('rule1');
      const rule2 = getChipText('rule2');
      const rule3 = getChipText('rule3');
      const getChoiceInfo = id => {
        const bar = document.querySelector(`[data-target="${id}"]`);
        const chip = bar?.querySelector('.chip[aria-pressed="true"]');
        if(!chip) return { text:'', desc:'' };
        if(chip.classList.contains('custom')){
          const input = document.getElementById(`${id}-custom`);
          return { text: input.value.trim(), desc: '' };
        }
        return { text: chip.textContent.trim(), desc: chip.dataset.desc || '' };
      };
      const modeInfo = getChoiceInfo('mode');
      const interactionInfo = getChoiceInfo('interaction');
      const notice = document.getElementById('notice').value.trim();
      const penalty = document.getElementById('penalty').value.trim();
      const pad = n => n.toString().padStart(2,'0');
      const dateStr = `${pad(m)}/${pad(d)}`;
      const timeStr = `${pad(sh)}:${pad(sm)}~${pad(eh)}:${pad(em)}`;
      const lines = [];
      lines.push(`<p><strong style="font-size: 24px;">â‘  êµë¥˜íšŒ ë‚´ìš©</strong></p>`);
      lines.push(`<p>${desc}</p>`);
      lines.push(`<br>`);
      lines.push(`<p><strong style="font-size: 24px;">â‘¡ êµë¥˜íšŒ ê·œì¹™</strong></p>`);
      lines.push(`<p>&lt;í•„ë…&gt;</p>`);
      lines.push(`<p>&nbsp;- êµë¥˜íšŒ ì¤‘ì—” ìµœì†Œ ì£¼í™©ë¶ˆë¡œ ì„¤ì •, ì„ì˜ë¡œ í¬íƒˆ ì„¤ì¹˜ ê¸ˆì§€</p>`);
      lines.push(`<p>&nbsp;- ë§¤ë„ˆì— ì–´ê¸‹ë‚˜ëŠ” í–‰ë™ ê¸ˆì§€</p>`);
      lines.push(`<p>&nbsp;- ì±„ë„ ê·œì¹™ì—ì„œ 'ì°¸ê°€ììš© ì•ˆë‚´ì‚¬í•­' ì½ì–´ë³´ê¸°</p>`);
      lines.push(`<br>`);
      lines.push(`<p>&lt;ê¸°ë³¸ ê·œì¹™&gt;</p>`);
      lines.push(`<p>&nbsp;- ì§‘í•© ì¥ì†Œ: <a href="${worldUrl}" target="_blank">${worldName}</a></p>`);
      lines.push(`<p>&nbsp;- êµë¥˜íšŒ ì •ì›: ${quota}ëª…</p>`);
      lines.push(`<p>&nbsp;- í…ìŠ¤ì³ ë©”ëª¨ë¦¬ ì œí•œ: ${texmem}MB</p>`);
      lines.push(`<p>&nbsp;- ê¸°ê¸° ì°©ìš© ì—¬ë¶€: ${rule1}</p>`);
      lines.push(`<p>&nbsp;- ë¬µì–¸ í—ˆìš© ì—¬ë¶€: ${rule2}</p>`);
      lines.push(`<p>&nbsp;- PCSS í—ˆìš© ì—¬ë¶€: ${rule3}</p>`);
      lines.push(`<br>`);
      lines.push(`<p>&lt;ë³µì¥ ê·œì¹™&gt;</p>`);
      lines.push(`<p>${modeInfo.text}${modeInfo.desc ? ` <span style="font-size: 12px;">(${modeInfo.desc})</span>` : ''}</p>`);
      lines.push(`<br>`);
      lines.push(`<p>&lt;ìƒí˜¸ì‘ìš© ê·œì¹™&gt;</p>`);
      lines.push(`<p>${interactionInfo.text}${interactionInfo.desc ? ` <span style="font-size: 12px;">(${interactionInfo.desc})</span>` : ''}</p>`);
      lines.push(`<br>`);
      lines.push(`<p>&lt;í”½ì—… ì—¬ë¶€&gt;</p>`);
      lines.push(`<p>${pickup}</p>`);
      lines.push(`<br>`);
      lines.push(`<p><strong style="font-size: 24px;">â‘¢ ê·¸ ì™¸ ì•ˆë‚´ì‚¬í•­</strong></p>`);
      lines.push(`<p>${notice}</p>`);
      lines.push(`<br>`);
      lines.push(`<p><strong style="font-size: 24px;">â‘£ ê·œì¹™ ìœ„ë°˜ ì‹œ ì¡°ì¹˜</strong></p>`);
      lines.push(`<p>${penalty}</p>`);
        const html = lines.join('\n');
      const titleStr = `[${dateStr} ${timeStr}] ${title}`;
      resultTitle.value = titleStr;
      resultBody.value = html;
      navigator.clipboard?.writeText(html).catch(()=>{});
      popup.hidden = false;
      popupContent.classList.remove('hide');
      void popupContent.offsetWidth;
      popupContent.classList.add('show');
    });
  </script>
</body>
</html>
